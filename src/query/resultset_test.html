<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ResultSet test</title>
    <script src="../../../closure-library/closure/goog/base.js"></script>
    <script src="../../../ydn-base/js/deps.js"></script>
    <script src="../../../ydn-db/js/deps.js"></script>
    <script type="text/javascript" src="../deps.js"></script>
    <script type="text/javascript">
        goog.require('ydn.db.text.ResultSet');
        goog.require('ydn.db.schema.fulltext.Catalog');
    </script>
</head>
<body>
    <script type="text/javascript">
        goog.require('goog.testing.jsunit');
        var ft_schema = ydn.db.schema.fulltext.Catalog.fromJson({
            name: 'test',
            lang: 'en',
            indexes: [
                {
                    storeName: 'article',
                    keyPath: 'title',
                    weight: 1.0
                }, {
                    storeName: 'article',
                    keyPath: 'body',
                    weight: 0.5
                }]
        });
        var query = new ydn.db.text.QueryEntry('first', 'first', 0, 'article', 'title');

        var test_add_result = function() {
            var rs = new ydn.db.text.ResultSet(ft_schema, [query], 10, 1);
            var results = [];
            for (var i = 0; i < 4; i++) {
              results[i] = {
                  keyword: 'first' + i,
                  value: 'first' + i,
                  score: 1,
                  source: {
                      storeName: 'article',
                      keyPath: 'title',
                      primaryKey: '1',
                      positions: [2]
                  }
              }
            }
            rs.addResult(query, results);
            assertEquals(4, rs.count());
        };
        var test_add_results = function() {
            var rs = new ydn.db.text.ResultSet(ft_schema, [query], 10, 1);
            var results = [];
            for (var i = 0; i < 4; i++) {
                results[i] = {
                    keyword: 'first' + i,
                    value: 'first' + i,
                    score: 1,
                    source: {
                        storeName: 'article',
                        keyPath: 'title',
                        primaryKey: '1',
                        position: i
                    }
                }
            }
            rs.addResult(query, results);
            results = [];
            for (var i = 0; i < 3; i++) {
                results[i] = {
                    key: 'second' + i,
                    value: 'second' + i,
                    score: 1,
                    source: {
                        storeName: 'article',
                        keyPath: 'title',
                        primaryKey: '1',
                        position: i
                    }
                }
            }
            rs.addResult(query, results);
            assertEquals(7, rs.count());
        };

    </script>
</body>
</html>